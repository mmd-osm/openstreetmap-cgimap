sudo: required
dist: xenial
language: cpp
compiler: gcc
cache: ccache
addons:
  postgresql: 9.4
  apt:
    packages:
      - libboost-dev
      - libboost-date-time-dev
      - libboost-filesystem-dev
      - libboost-locale-dev
      - libboost-program-options-dev
      - libboost-regex-dev
      - libboost-system-dev
      - libcrypto++-dev
      - libfcgi-dev
      - libmemcached-dev
      - libpqxx-dev
      - libxml2-dev
      - libyajl-dev
      - lcov
script:
  - ./autogen.sh
  - ./configure --enable-yajl CC="ccache gcc" CXX="ccache g++" CXXFLAGS="-coverage"
  - make
  - make check
  - lcov --capture --directory /home/travis/build/mmd-osm/openstreetmap-cgimap --output-file ~/coverage.info
  - lcov --remove ~/coverage.info '/usr/*' --output-file ~/coverage.info
  - lcov --list ~/coverage.info
after_failure:
  - cat test-suite.log
after_success:
  - bash <(curl -s https://codecov.io/bash) -f ~/coverage.info

